<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <script src="../../webcomponentsjs/webcomponents-lite.js"></script> 
  <script src="../../web-component-tester/browser.js"></script> 
  <script src="../../fetch/fetch.js"></script> 
  <link rel="import" href="../../polymer/polymer.html">


  <script src="../hydrolysis.js"></script> 
  <link id="parsetarget" rel="import" href="static/html-parse-target.html">
</head>
<body>
  <script>
    suite('parser throws errors', function() {
      var hyd = require('hydrolysis');
      /* Two js documents, one with an error and one with a module declaration. */
      var parsed, parseError;
      suiteSetup(function(done) {
        async.series([
          function(cb){
            fetch('static/js-parse-error.js')
              .then(function(js){
                return js.text();
              }).then(function(text){
                parseError = text;
                cb();
              });
          },
          function(cb){
            fetch('static/js-modules.js')
              .then(function(js){
                return js.text()
              }).then(function(text){
                parsed = hyd.jsParse(text);
                cb();
              });
          },
          function(){
            done();
          }
        ]);  
      });

      test('js syntax error', function() {
        try {
          hyd.jsParse(parseError);
        } catch (err) {
          assert.equal(err.lineNumber, 18);
          assert.equal(err.column, 34);
        }
      });


      test('Find all modulate calls', function() {
        console.log(parsed);
        assert.equal(parsed.modules.length, 2);
      });

      test('Find all modulate dependencies', function() {
        var foundDeps = false;
        for (var i = 0; i < parsed.modules.length; i++) {
          var module = parsed.modules[i];
          if (module.is == "x-resizer") {
            console.log(module);
            assert.equal(module.deps.length, 2);
            foundDeps = true;
          }
        }
        assert(foundDeps);
      });

      test('Find all modulate properties', function() {
        var foundProps = false;
        for (var i = 0; i < parsed.modules.length; i++) {
          var module = parsed.modules[i];
          if (module.is == "x-resizable") {
            assert.equal(module.properties.length, 3);
            assert.equal(module.properties[0].name, "resizableAttached");
            foundProps = true;
          }
        }
        assert(foundProps);
      })

      test('All polymer calls have associated metadata', function() {
      });



      test('Find all polymer calls', function() {
      });

      test('Polymer call has a description', function() {
      });

      test('Polymer call has ', function() {
      });

      


    });
  </script>
</body>
</html>